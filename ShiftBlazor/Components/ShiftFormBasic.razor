@using Microsoft.AspNetCore.Components.Forms
@using static ShiftSoftware.ShiftBlazor.Utils.Form
@typeparam T where T : class, new()
@using Blazored.FluentValidation

@if (!string.IsNullOrWhiteSpace(DocumentTitle))
{
    <PageTitle>@DocumentTitle</PageTitle>
}

<article>
    <EditForm EditContext="editContext" OnValidSubmit="ValidSubmitHandler" OnInvalidSubmit="InvalidSubmitHandler" style="height: 100%;" con>
        <FluentValidationValidator DisableAssemblyScanning="Validator != null" Validator="Validator" />
        @if (Validator == null)
        {
            <DataAnnotationsValidator/>
        }

        <MudPaper Elevation="25" Style="height: 100%;">

            <header>
                @if (!DisableHeaderToolbar)
                {
                    <MudToolBar Dense="true" DisableGutters="false" Class="light-toolbar shift-toolbar-header">
                        <MudIcon Icon="@IconSvg"></MudIcon>
                        <MudText Class="px-4" Style="margin:0;">@(Title ?? "Form")</MudText>

                        @ToolbarStartTemplate

                        <MudSpacer></MudSpacer>

                        @if (ToolbarCenterTemplate != null)
                        {
                            @ToolbarCenterTemplate
                            <MudSpacer></MudSpacer>
                        }

                        @ToolbarEndTemplate

                        @if (ToolbarEndTemplate != null && MudDialog != null)
                        {
                            <MudDivider Vertical="true" Style="height: 60%;align-self: center;margin-inline: 5px;opacity: 0.5;"></MudDivider>
                        }

                        @if (MudDialog != null)
                        {
                            @ToolbarControlsTemplate

                            <MudTooltip Text="Close">
                                <MudButton Style="min-width:40px;" Variant="Variant.Text" Size="Size.Medium" Color="Color.Default" OnClick="() => Cancel()">
                                    <MudIcon Size="Size.Medium" Icon="@Icons.Material.Filled.Close" />
                                </MudButton>
                            </MudTooltip>
                        }
                    </MudToolBar>
                }

                @HeaderTemplate
            </header>

            <div class="@(MudDialog != null ? "shift-scrollable-content-wrapper form-body" : "form-body")">
                <div class="pa-6">
                    <CascadingValue Value="State">
                        @ChildContent
                    </CascadingValue>
                </div>
            </div>

            <footer>
                @FooterTemplate

                @if (!DisableFooterToolbar)
                {
                    <MudToolBar>

                        @FooterToolbarStartTemplate

                        <MudSpacer></MudSpacer>

                        @if (FooterToolbarCenterTemplate != null)
                        {
                            @FooterToolbarCenterTemplate
                            <MudSpacer></MudSpacer>
                        }

                        @FooterToolbarEndTemplate

                        <MudButton Color="Color.Primary" ButtonType="ButtonType.Submit" Disabled="@(State == States.Saving)">
                            @if (State == States.Saving)
                            {
                                <MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true" />
                            }
                            else
                            {
                                <MudIcon Icon="@Icons.Material.Filled.Save" />
                            }

                            <MudText Style="padding:0 10px;">Submit</MudText>
                        </MudButton>
                    </MudToolBar>
                }

            </footer>
        </MudPaper>
    </EditForm>

</article>