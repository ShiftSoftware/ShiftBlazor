@using Syncfusion.Blazor.Navigations
@typeparam TValue where TValue : ShiftEntityDTOBase, new()
@inject IStringLocalizer<Resources.Components.ShiftList> Loc
@namespace ShiftSoftware.ShiftBlazor.Components

<MudToolBar Dense="true" DisableGutters="false" Class="my-2" Style="display: flex; overflow: hidden;" WrapContent="true">
    
    <MudPagination Count="Context?.TotalPages ?? 1"
                   BoundaryCount="1"
                   MiddleCount="5"
                   ShowFirstButton="true"
                   ShowLastButton="true"
                   @bind-Selected="CurrentPage" />

    <MudSpacer />

    @if (!ShiftList.DisableSelection && (ShiftList.SelectedItems?.Items?.Count > 0 || ShiftList.SelectedItems?.All == true))
    {
        <MudChip Style="display: inline-flex;" Icon="@Icons.Material.Rounded.Check" title="@Loc["SelectedItemsCounterLabel"]" OnClose="() => ShiftList.Grid!.ClearRowSelectionAsync()">@(ShiftList.SelectedItems.All ? "All" : ShiftList.SelectedItems?.Items?.Count)</MudChip>
    }
    
    <MudMenu AnchorOrigin="Origin.BottomLeft">
        <ActivatorContent>
            <MudChip Style="display: inline-flex;" Icon="@Icons.Material.Rounded.List" title="@Loc["ItemsPerPageLabel"]">@ShiftList.PageSize!.Value</MudChip>
        </ActivatorContent>
        <ChildContent>
            @foreach (var size in ShiftList.PageSizes)
            {
                <MudMenuItem OnClick="() => { ShiftList.PageSizeChangeHandler(size);}">@size</MudMenuItem>
            }
        </ChildContent>
    </MudMenu>

    <MudChip Style="display: inline-flex;" Icon="@Icons.Material.Rounded.Spoke" title="@Loc["TotalItemsLabel"]">@Context?.TotalItemsCount</MudChip>
</MudToolBar>

@code {
    [CascadingParameter]
    public ShiftList<TValue> ShiftList { get; set; } = default!;

    [Parameter]
    public PagerTemplateContext? Context { get; set; }

    private SelectedItems<string>? SelectedItems { get; set; }

    private int CurrentPage
    { 
        get
        {
            return ShiftList.Grid!.PageSettings.CurrentPage;
        }
        set
        {
            _ = ShiftList.Grid!.GoToPageAsync(value);
        }
    }
}